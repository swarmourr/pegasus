x-pegasus:
  apiLang: python
  createdBy: poseidon
  createdOn: 02-14-24T13:07:45Z
pegasus: 5.0.4
name: federated-learning-example-tracker
metadata:
  wf_track: 'True'
siteCatalog:
  sites:
  - name: local
    directories:
    - type: sharedScratch
      path: /home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/scratch
      sharedFileSystem: false
      fileServers:
      - url: file:///home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/scratch
        operation: all
    - type: localStorage
      path: /home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/output
      sharedFileSystem: false
      fileServers:
      - url: file:///home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/output
        operation: all
  - name: condorpool
    directories: []
    profiles:
      condor:
        universe: vanilla
      pegasus:
        style: condor
replicaCatalog:
  replicas:
  - lfn: source_data
    pfns:
    - site: local
      pfn: /home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/data/oneyeardata.csv
transformationCatalog:
  transformations:
  - name: init_env
    sites:
    - name: condorpool
      pfn: /home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/bin/init_env.py
      type: stageable
      container: federated_learning_container
  - name: local_clustering
    sites:
    - name: condorpool
      pfn: /home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/bin/localClustering.py
      type: stageable
      container: federated_learning_container
  - name: global_clustering
    sites:
    - name: condorpool
      pfn: /home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/bin/globalClustering.py
      type: stageable
      container: federated_learning_container
  containers:
  - name: federated_learning_container
    type: singularity
    image: /home/poseidon/workflows/FL-workflow/federated-learning-fedstack-PM/containers/fl.sif
    image.site: local
jobs:
- type: job
  name: init_env
  id: prepare_input_files
  nodeLabel: prepare_input_files
  arguments:
  - -f source_data -size 10000 -n global_model_round_init.h5 -s 784 -c 10
  uses:
  - lfn: worker-2.novalocal_data.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: output
    stageOut: true
    registerReplica: false
  - lfn: clusters.json
    metadata:
      output_track: 'True'
    type: output
    stageOut: true
    registerReplica: false
  - lfn: source_data
    metadata:
      input_track: 'True'
      mlflow: auto
    type: input
  - lfn: ref_dist.npy
    metadata:
      output_track: 'True'
      mlflow: auto
    type: output
    stageOut: true
    registerReplica: false
  - lfn: worker-3.novalocal_data.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: output
    stageOut: true
    registerReplica: false
  - lfn: worker-1.novalocal_data.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: output
    stageOut: true
    registerReplica: false
- type: job
  name: local_clustering
  id: local_clustering_worker-1.novalocal
  nodeLabel: local_clustering_worker-1.novalocal
  arguments:
  - -f worker-1.novalocal_data.csv -dist ref_dist.npy -node worker-1.novalocal
  uses:
  - lfn: worker-1.novalocal_clusters.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: output
    stageOut: true
    registerReplica: false
  - lfn: worker-1.novalocal_data.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
  - lfn: ref_dist.npy
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
- type: job
  name: local_clustering
  id: local_clustering_worker-2.novalocal
  nodeLabel: local_clustering_worker-2.novalocal
  arguments:
  - -f worker-2.novalocal_data.csv -dist ref_dist.npy -node worker-2.novalocal
  uses:
  - lfn: ref_dist.npy
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
  - lfn: worker-2.novalocal_clusters.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: output
    stageOut: true
    registerReplica: false
  - lfn: worker-2.novalocal_data.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
- type: job
  name: local_clustering
  id: local_clustering_worker-3.novalocal
  nodeLabel: local_clustering_worker-3.novalocal
  arguments:
  - -f worker-3.novalocal_data.csv -dist ref_dist.npy -node worker-3.novalocal
  uses:
  - lfn: ref_dist.npy
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
  - lfn: worker-3.novalocal_clusters.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: output
    stageOut: true
    registerReplica: false
  - lfn: worker-3.novalocal_data.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
- type: job
  name: global_clustering
  id: global_clustering
  nodeLabel: global_clustering
  arguments:
  - -f worker-1.novalocal_clusters.csv worker-2.novalocal_clusters.csv worker-3.novalocal_clusters.csv
  uses:
  - lfn: worker-3.novalocal_clusters.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
  - lfn: worker-1.novalocal_clusters.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
  - lfn: worker-2.novalocal_clusters.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: input
  - lfn: global_clustering_results.csv
    metadata:
      output_track: 'True'
      mlflow: auto
    type: output
    stageOut: true
    registerReplica: false
jobDependencies:
- id: prepare_input_files
  children:
  - local_clustering_worker-3.novalocal
  - local_clustering_worker-1.novalocal
  - local_clustering_worker-2.novalocal
- id: local_clustering_worker-1.novalocal
  children:
  - global_clustering
- id: local_clustering_worker-2.novalocal
  children:
  - global_clustering
- id: local_clustering_worker-3.novalocal
  children:
  - global_clustering
